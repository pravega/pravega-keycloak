#
# Copyright (c) 2019 Dell Inc., or its subsidiaries. All Rights Reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
language: java
install: true
jdk:
  - openjdk8

jobs:
  include:
    # the secure configurations in env: is for BINTRAY_USER=<USER> and BINTRAY_KEY=<KEY> properties
    # which will be used for publishing artifacts to snapshot repository
    - stage: build
      if: type IN (push, pull_request)
      install: ./gradlew assemble
      script: ./gradlew check
      after_success:
        - bash <(curl -s https://codecov.io/bash) -t c82b7db7-70b1-4264-9b8a-b74c077e974d

    - stage: snapshot
      if: (branch = master OR branch =~ ^release-) AND NOT (type = pull_request)
      env:
        - secure: "b0bjalNxVONIKDkRPVbhtVE+gbCsSYyrAOH1roGANkJzLM45ha6rQn7vbu673dtl5ZBl5M7D/MNrpGcqkFLNkitCI68vS5u/AYj3/zJ1ARowXvuzsey585ncDySPvSa4SJIyF1QZsxI7VD1rEMO5Ix8osPsfLPbCjHioIjmXeaUJ67rNcjfKcUhFANi7VeT/qrkP0NdZ+o/frxiUl7BwgaFEcQL+jLwbI6vc4T0FB9VUH/bANDNOdR7c0pyzkf/uSAv8R+PLUu1c2DEaBSlmXsI6ec90S+1rBCwPQdOQbxJMcJgxQNJxazI40G/nM+ZJz8TGDeyAcL3SKb41MwpdhVKahNotiYDma/1APcOB2NjxJYpY796cODdO+j6uC4xW1Uh8Im45OPnqeo07/o9+Djg0t5Dk0rcCar5EEFk6MYAwbaWD4vwCi4pgdneUktlhRW5+GXy1jhQCepJ8alSuEKxN1hTu3/4/Gb41wtV8gNuXKYIxniigLeSu5Vj5nP24y8kG1XcKlM0UwfTcj4TZ6W0/9ssgSXnhNPR60j2GUymx3n9Hx8jlA25XM1X8pJbwDfpI4Dp6oDOnLHoGJoE4y0g8XeMEdfgFeyg8d47Zo4bLZFvhP8kqMTzkTUR76+e5pbiCYH0DTASEyzcIBVSyGw3rPThPldSezjnX3IQsE2I="
        - secure: "OSIHX2cBMi0FhBDI0SLUxhqqBaSX3tOOKVIrysjo+snlrXGntAyv8yXe3ppHQWZpxdF3juLzMh3d9D8BDIw0ghBvFoHHkJHZWod+pFJzaIzpLKulsmeq1wV72/NEPxb7VaUhlOs+x5x8jLSQ27bBf1K14B2bUcwEGIsT8OqNmE0Hm1PTkl0/Qz50XSxSmhTzGh7eb1NMVb9zhQdYbJycDSI+fxG+3m45SGOSNzCLpe2ssFySVYX+rNmu4K9hO4HtbUP2cCCDwLnsCW9+Ub0ROph0q1B3KuL8GsQtufGxvcjihRNnixz9iUCOqYC4fp4QXRhBwRHXcb8GAPcwvdpVU4GewNOMl87TKWb42KOLJqErMn5lbs8SQ4Q9bN5fkweMXvcKyTJ7Ea9A0mJL3l80RQyTJ+0B2J4NwVevsDdIK2Ex7i5awYZl99zu3F5RBvcL90C4HGFKtxCuDpJGyi3Hg3eF9ThIaZ3/xin+yM9nPFrS/HKGepzZj0Jt0ptKMV4kF3tyWpRlX8K1aaUZQaRDXbp9q+0hQrmbM8iMb37BaXbOCsP3iSG3DpIfMdnLQc2mxSu7fIEJrRpJWTHSjTL0mBtfqLEwfAPQlBbdZUc5QIRpCSFGG+hic4VXFC8itoqON1NpSg+HqJlJfH0cfzvc/w4ytHDER71pqzZz+OMPoOQ="
      install: skip
      script: ./gradlew artifactoryPublish -PpublishUsername=$BINTRAY_USER -PpublishPassword=$BINTRAY_KEY

before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/

#notifications:
#  slack:
#    matrix:
#      - secure: Gv0RJx1Sa/y5fmvLNwY+2ivfWZYCM0ekrr6UAHqsegnid6P/DFZrSrfSpwvcVh2OVNH8DHLV0BoiuDJ7amtl1eMDMXz5/lLz8tFWFKaHv4yDSadm8ILY/KnYUoP4IRuM3NyKQmBrmZB9Or5KFXboG6ex6UkgbuYy0Zyl6syEe168Iw8hlCRx26Jei7/y+8eE2MIGFh09TLRZ/944YbULum9H3KQLYv8nFdPc7GmR5AK461fnwZ7iYjb7MXkCctE5Vml3p9+2Qliv1ZJqNsQeKmSFW6IhiP6pNZ1V8VJEWMQmX/nBr9745l/N+CoLQz9ajLonlxn9xHdWms4TEu1ynFk6uxEJjlcpXcvcEaKhqAKcTMl0GMMRab2m+/Vt3S/VutJnVXQmnhZGT9glLFQHwcdHNqM/LEbXtyisB7zmGImUQpF2InCwO25IXug5gv64IfOHGMzL56yNIhbRgBY9Ud4Tux+pmkV5ZxJiBkul7/FiHQX7tQLUrzQosD0oyCOmaWD7kmbt15A0TOkLgup4HE+sSS1ASwisa7J2+HsbI3Upy3rNVKuIJP0L4KSTn4HSlDlMLLcWM+nz/YCEfuwSRXJTIstotNYHdsLUZAZSYAX7ejpeiuBRed4a4AlCROeKbKKwCcSvqCOjmCaPTpwJAGeJByOXLL2hfQzpDMKCIKM=
#    rooms:
#      - secure: Gv0RJx1Sa/y5fmvLNwY+2ivfWZYCM0ekrr6UAHqsegnid6P/DFZrSrfSpwvcVh2OVNH8DHLV0BoiuDJ7amtl1eMDMXz5/lLz8tFWFKaHv4yDSadm8ILY/KnYUoP4IRuM3NyKQmBrmZB9Or5KFXboG6ex6UkgbuYy0Zyl6syEe168Iw8hlCRx26Jei7/y+8eE2MIGFh09TLRZ/944YbULum9H3KQLYv8nFdPc7GmR5AK461fnwZ7iYjb7MXkCctE5Vml3p9+2Qliv1ZJqNsQeKmSFW6IhiP6pNZ1V8VJEWMQmX/nBr9745l/N+CoLQz9ajLonlxn9xHdWms4TEu1ynFk6uxEJjlcpXcvcEaKhqAKcTMl0GMMRab2m+/Vt3S/VutJnVXQmnhZGT9glLFQHwcdHNqM/LEbXtyisB7zmGImUQpF2InCwO25IXug5gv64IfOHGMzL56yNIhbRgBY9Ud4Tux+pmkV5ZxJiBkul7/FiHQX7tQLUrzQosD0oyCOmaWD7kmbt15A0TOkLgup4HE+sSS1ASwisa7J2+HsbI3Upy3rNVKuIJP0L4KSTn4HSlDlMLLcWM+nz/YCEfuwSRXJTIstotNYHdsLUZAZSYAX7ejpeiuBRed4a4AlCROeKbKKwCcSvqCOjmCaPTpwJAGeJByOXLL2hfQzpDMKCIKM=
#  email:
#    - eron.wright@emc.com
#    - Flavio.Junqueira@emc.com
